import{u as k,j as e,t as g}from"./main-dCWhs5Ab.js";import{u as _,F as d,a as h,b as x,c as S}from"./use-shows-fF3Cj4pM.js";import{a as w}from"./Button-J-NJUGUV.js";import{I as b,C as c}from"./Input-Cf5H69Wp.js";import{S as l}from"./Select-lrVHPkTf.js";import{u as C}from"./useMutation-DIq7UHwp.js";import{b as y,o as j,s as m,n as f,e as B}from"./endpoint-DMaDmk8U.js";import{b as p}from"./queries-wK0phKyJ.js";import"./utils-BeoR-wkN.js";import"./useQuery-BpxkjsUK.js";j({show_id:m().uuid(),number_of_tickets:f().int().min(1),customer_email:m().email()});const N=j({booking_id:m().uuid()});async function T(s){const r=y(["api","book-tickets"]),n=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok)throw new Error(`Failed to create booking: ${n.statusText}`);const u=await n.json();return N.parse(u)}function F(s){const r=k();return C({mutationKey:p.mutations.create(),mutationFn:n=>T(n),onSuccess:n=>{r.invalidateQueries({queryKey:p.all()}),s?.onSuccess?.(n)},onError:s?.onError})}const E=j({show_id:m().min(1),number_of_tickets:f().int().min(1),customer_email:B()});function I({shows:s}){const r=F({onSuccess:t=>{g.success("Booking created successfully!",{description:`Confirmation number: ${t.booking_id}`}),n.reset()},onError:t=>{g.error("Failed to create booking",{description:t.message})}}),n=_({defaultValues:{show_id:"",number_of_tickets:1,customer_email:""},validators:{onSubmit:E},onSubmit:async({value:t})=>{r.mutate(t)}});if(s.length===0)return e.jsx(v,{children:e.jsx(P,{})});function u(t){t.preventDefault(),n.handleSubmit()}return e.jsx(v,{children:e.jsxs("form",{onSubmit:u,className:"space-y-6",children:[e.jsx(n.Field,{name:"show_id",children:t=>{const o=t.state.meta.isTouched&&t.state.meta.errors.length>0,i=s.find(a=>a.show_id===t.state.value);return e.jsxs(d,{"data-invalid":o,children:[e.jsx(h,{children:"Select Show"}),e.jsxs(l,{value:t.state.value,onValueChange:a=>t.handleChange(a),disabled:r.isPending,children:[e.jsx(l.Trigger,{children:e.jsx(l.Value,{placeholder:"Choose a show..."})}),e.jsx(l.Content,{children:s.map(a=>e.jsxs(l.Item,{value:a.show_id,children:[a.title," @ ",a.venue," -"," ",new Date(a.start_time).toLocaleDateString()]},a.show_id))})]}),i&&e.jsx(L,{count:i.number_of_tickets}),e.jsx(x,{errors:t.state.meta.errors})]})}}),e.jsx(n.Field,{name:"number_of_tickets",children:t=>{const o=t.state.meta.isTouched&&t.state.meta.errors.length>0;return e.jsxs(d,{"data-invalid":o,children:[e.jsx(h,{children:"Number of Tickets"}),e.jsx(b,{type:"number",value:t.state.value,onChange:i=>t.handleChange(parseInt(i.target.value,10)),onBlur:t.handleBlur,placeholder:"e.g., 2",min:"1",disabled:r.isPending,"aria-invalid":o}),e.jsx(x,{errors:t.state.meta.errors})]})}}),e.jsx(n.Field,{name:"customer_email",children:t=>{const o=t.state.meta.isTouched&&t.state.meta.errors.length>0;return e.jsxs(d,{"data-invalid":o,children:[e.jsx(h,{children:"Customer Email"}),e.jsx(b,{type:"email",value:t.state.value,onChange:i=>t.handleChange(i.target.value),onBlur:t.handleBlur,placeholder:"customer@example.com",disabled:r.isPending,"aria-invalid":o}),e.jsx(x,{errors:t.state.meta.errors})]})}}),e.jsx(w,{type:"submit",disabled:r.isPending,children:r.isPending?"Booking...":"Book Tickets"})]})})}function v({children:s}){return e.jsxs(c,{className:"animate-in fade-in slide-in-from-bottom-4 duration-500  w-full",children:[e.jsx(c.Header,{children:e.jsx(c.Title,{children:"BOOK TICKETS"})}),e.jsx(c.Content,{children:s})]})}function P(){return e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("p",{className:"text-lg mb-4",children:"No shows available yet!"}),e.jsx("p",{className:"text-muted-foreground",children:'Create a show in the "Shows" tab first.'})]})}function L({count:s}){return e.jsxs("p",{className:"text-sm mt-2 p-3 bg-muted border-2 border-black",children:["Available tickets: ",e.jsx("strong",{children:s})]})}function J(){const{data:s,isLoading:r,error:n}=S();return r||s===void 0||s===null?e.jsx("div",{className:"max-w-2xl",children:e.jsx("p",{children:"Loading shows..."})}):n?e.jsx("div",{className:"max-w-2xl",children:e.jsxs("p",{className:"text-red-600",children:["Error loading shows: ",n.message]})}):e.jsx("div",{className:"max-w-2xl",children:e.jsx(I,{shows:s})})}export{J as component};
