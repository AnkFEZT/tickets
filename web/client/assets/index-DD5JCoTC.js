import{r as c,j as e,u as U}from"./main-dCWhs5Ab.js";import{C as g,I as l}from"./Input-Cf5H69Wp.js";import{c as T,b as K,a as I}from"./Button-J-NJUGUV.js";import{c as F,g as f}from"./utils-BeoR-wkN.js";import{S as r}from"./Select-lrVHPkTf.js";import{u as q}from"./useMutation-DIq7UHwp.js";import{b as R,o as y,s as u,_,a as L}from"./endpoint-DMaDmk8U.js";import{t as P}from"./queries-DPZSBU53.js";var B=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],M=B.reduce((t,s)=>{const a=T(`Primitive.${s}`),o=c.forwardRef((m,p)=>{const{asChild:x,...h}=m,j=x?a:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(j,{...h,ref:p})});return o.displayName=`Primitive.${s}`,{...t,[s]:o}},{}),V="Label",E=c.forwardRef((t,s)=>e.jsx(M.label,{...t,ref:s,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(t.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));E.displayName=V;var G=E;const O=K("leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=({className:t,...s})=>e.jsx(G,{className:F(O(),t),...s}),$=y({ticket_id:u(),booking_id:u(),status:_(["confirmed","canceled"]),price:y({amount:u(),currency:u()}),customer_email:u().email()});y({tickets:L($)});async function Q(t,s){const a=R(["api","tickets-status"]),o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","Idempotency-Key":s},body:JSON.stringify(t)});if(!o.ok)throw new Error(`Failed to update tickets status: ${o.statusText}`)}function H(t){const s=U();return q({mutationKey:P.mutations.updateStatus(),mutationFn:({tickets:a,idempotencyKey:o})=>Q({tickets:a},o),onSuccess:()=>{s.invalidateQueries({queryKey:P.all()}),t?.onSuccess?.()},onError:t?.onError})}function J(){const[t,s]=c.useState(""),[a,o]=c.useState(""),[m,p]=c.useState("confirmed"),[x,h]=c.useState(""),[j,v]=c.useState("USD"),[S,C]=c.useState(""),[k,b]=c.useState(f()),[D,N]=c.useState(!1),i=H({onSuccess:()=>{N(!0),setTimeout(()=>{s(""),o(""),p("confirmed"),h(""),v("USD"),C(""),b(f()),N(!1)},3e3)}}),w=()=>{b(f())},A=n=>{n.preventDefault(),i.mutate({tickets:[{ticket_id:t,booking_id:a,status:m,price:{amount:x,currency:j},customer_email:S}],idempotencyKey:k})};return e.jsxs(g,{className:"animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsxs(g.Header,{children:[e.jsx(g.Title,{children:"SIMULATE EXTERNAL CALLBACK"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Simulate ticket status updates from external systems (e.g., Dead Nation)"})]}),e.jsx(g.Content,{children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"ticketId",children:"Ticket ID"}),e.jsx(l,{id:"ticketId",value:t,onChange:n=>s(n.target.value),placeholder:"Enter ticket ID",required:!0,disabled:i.isPending})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"bookingId",children:"Booking ID"}),e.jsx(l,{id:"bookingId",value:a,onChange:n=>o(n.target.value),placeholder:"Enter booking ID",required:!0,disabled:i.isPending})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Status"}),e.jsxs(r,{value:m,onValueChange:n=>p(n),disabled:i.isPending,children:[e.jsx(r.Trigger,{id:"status",children:e.jsx(r.Value,{})}),e.jsxs(r.Content,{children:[e.jsx(r.Item,{value:"confirmed",children:"Confirmed"}),e.jsx(r.Item,{value:"canceled",children:"Canceled"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"customerEmail",children:"Customer Email"}),e.jsx(l,{id:"customerEmail",type:"email",value:S,onChange:n=>C(n.target.value),placeholder:"customer@example.com",required:!0,disabled:i.isPending})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"priceAmount",children:"Price Amount"}),e.jsx(l,{id:"priceAmount",type:"number",step:"0.01",value:x,onChange:n=>h(n.target.value),placeholder:"e.g., 49.99",min:"0",required:!0,disabled:i.isPending})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"priceCurrency",children:"Price Currency"}),e.jsxs(r,{value:j,onValueChange:v,disabled:i.isPending,children:[e.jsx(r.Trigger,{id:"priceCurrency",children:e.jsx(r.Value,{})}),e.jsxs(r.Content,{children:[e.jsx(r.Item,{value:"USD",children:"USD"}),e.jsx(r.Item,{value:"EUR",children:"EUR"}),e.jsx(r.Item,{value:"GBP",children:"GBP"}),e.jsx(r.Item,{value:"AUD",children:"AUD"}),e.jsx(r.Item,{value:"CAD",children:"CAD"})]})]})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsxs(d,{htmlFor:"idempotencyKey",children:["Idempotency Key"," ",e.jsx("span",{className:"text-muted-foreground text-xs",children:"(for testing duplicate requests)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{id:"idempotencyKey",value:k,onChange:n=>b(n.target.value),className:"font-mono text-sm",required:!0,disabled:i.isPending}),e.jsx(I,{type:"button",variant:"secondary",onClick:w,disabled:i.isPending,children:"Generate New"})]})]})]}),e.jsx(I,{type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:i.isPending?"Submitting...":"Submit Status Update"}),i.isError&&e.jsx("div",{className:"mt-4 p-4 bg-red-100 border-2 border-black",children:e.jsxs("p",{className:"font-bold text-red-800",children:["✗ Error:"," ",i.error instanceof Error?i.error.message:"An unknown error occurred"]})}),D&&e.jsx("div",{className:"mt-4 p-4 bg-primary border-2 border-black",children:e.jsxs("p",{className:"font-bold",children:["✓ Status update submitted for ticket: ",e.jsx("code",{children:t})]})})]})})]})}function re(){return e.jsx("div",{className:"max-w-3xl",children:e.jsx(J,{})})}export{re as component};
