import{j as e}from"./main-dCWhs5Ab.js";import{T as r}from"./Table-DH2M_JZR.js";import{f as x}from"./utils-BeoR-wkN.js";import{u}from"./useQuery-BpxkjsUK.js";import{q as p}from"./queries-wK0phKyJ.js";import"./endpoint-DMaDmk8U.js";function f(s){return u(p.list(s))}const j="0001-01-01T00:00:00Z";function l(s){return!!s&&s!==j}function m(s){return l(s)?new Date(s).toLocaleString():"-"}function h({booking:s,ticketCount:n}){return e.jsx("div",{className:"w-full p-4 border-2 border-black bg-muted",children:e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Booking ID"}),e.jsx("p",{className:"font-mono font-bold",children:s.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Booked At"}),e.jsx("p",{className:"font-bold",children:new Date(s.bookedAt).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Tickets"}),e.jsxs("p",{className:"font-bold",children:[n," ticket(s)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:"Last Update"}),e.jsx("p",{className:"font-bold",children:s.lastUpdate?new Date(s.lastUpdate).toLocaleString():"N/A"})]})]})})}function g({ticket:s}){const n=l(s.refundedAt),d=l(s.confirmedAt),o=l(s.printedAt),i=l(s.receiptIssuedAt);return e.jsxs(r.Row,{children:[e.jsx(r.Cell,{className:"font-mono text-sm",children:s.id}),e.jsx(r.Cell,{className:n?"line-through":"",children:x(parseFloat(s.priceAmount),s.priceCurrency)}),e.jsx(r.Cell,{className:"text-sm",children:s.customerEmail}),e.jsx(r.Cell,{className:"text-sm",children:m(d?s.confirmedAt:null)}),e.jsx(r.Cell,{className:"text-sm",children:m(o?s.printedAt:null)}),e.jsx(r.Cell,{className:"font-mono text-xs",children:"-"}),e.jsx(r.Cell,{className:"text-sm",children:m(i?s.receiptIssuedAt:null)}),e.jsx(r.Cell,{className:"font-mono",children:s.receiptNumber||"-"}),e.jsx(r.Cell,{className:"text-sm",children:n?e.jsx("span",{className:"text-destructive font-bold",children:m(s.refundedAt)}):"-"})]})}function N({tickets:s}){return s.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No tickets found for this booking."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(r,{children:[e.jsx(r.Header,{children:e.jsxs(r.Row,{children:[e.jsx(r.Head,{children:"Ticket ID"}),e.jsx(r.Head,{children:"Price"}),e.jsx(r.Head,{children:"Email"}),e.jsx(r.Head,{children:"Confirmed At"}),e.jsx(r.Head,{children:"Printed At"}),e.jsx(r.Head,{children:"Printed File"}),e.jsx(r.Head,{children:"Receipt Issued"}),e.jsx(r.Head,{children:"Receipt #"}),e.jsx(r.Head,{children:"Refunded At"})]})}),e.jsx(r.Body,{children:s.map(n=>e.jsx(g,{ticket:n},n.id))})]})})}function A({booking:s,tickets:n}){return e.jsxs("div",{className:"space-y-1",children:[e.jsx(h,{booking:s,ticketCount:n.length}),e.jsx(N,{tickets:n})]})}function b(){const{data:s=[],isLoading:n,error:d}=f(),o=s.map(c=>({id:c.booking_id,bookedAt:c.booked_at,lastUpdate:c.last_update,tickets:Object.fromEntries(Object.entries(c.tickets).map(([a,t])=>[a,{id:a,priceAmount:t.price_amount,priceCurrency:t.price_currency,customerEmail:t.customer_email,confirmedAt:t.confirmed_at,printedAt:t.printed_at,printedFileName:t.printed_file_name,receiptIssuedAt:t.receipt_issued_at,receiptNumber:t.receipt_number,refundedAt:t.refunded_at}]))}));return{bookings:o,isLoading:n,error:d,getBookingTickets:c=>{const a=o.find(t=>t.id===c);return a?Object.values(a.tickets):[]}}}function R(){const{bookings:s,isLoading:n,error:d,getBookingTickets:o}=b();return n?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-lg",children:"Loading bookings..."})}):d?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-lg text-destructive font-bold",children:"Error loading data"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:d instanceof Error?d.message:"Unknown error"})]}):s.length===0?e.jsx("p",{className:"text-center py-8 text-lg",children:"No bookings yet. Book some tickets first!"}):e.jsx("div",{className:"space-y-4",children:s.map(i=>e.jsx(A,{booking:i,tickets:o(i.id)},i.id))})}export{R as component};
