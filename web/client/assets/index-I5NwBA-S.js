import{u as N,j as e,t as j}from"./main-dCWhs5Ab.js";import{q as w,s as C,u as S,F as d,a as c,b as m,c as T}from"./use-shows-fF3Cj4pM.js";import{a as g}from"./Button-J-NJUGUV.js";import{C as h,I as u}from"./Input-Cf5H69Wp.js";import{g as y}from"./utils-BeoR-wkN.js";import{u as F}from"./useMutation-DIq7UHwp.js";import{b as I,o as x,s as l,n as p,u as _}from"./endpoint-DMaDmk8U.js";import{T as s}from"./Table-DH2M_JZR.js";import"./useQuery-BpxkjsUK.js";x({dead_nation_id:l().uuid(),number_of_tickets:p().int().positive(),start_time:l().datetime(),title:l(),venue:l()});const k=x({show_id:l().uuid()});async function D(r){const i=I(["api","shows"]),a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!a.ok)throw new Error(`Failed to create show: ${a.statusText}`);const o=await a.json();return k.parse(o)}function B(r){const i=N();return F({mutationKey:C.mutations.create(),mutationFn:a=>D(a),onError:r?.onError,onSuccess:a=>{i.invalidateQueries(w.list()),r?.onSuccess?.(a)}})}const E=x({title:l().min(3,"Show title must be at least 3 characters.").max(100,"Show title must be at most 100 characters."),venue:l().min(2,"Venue name must be at least 2 characters.").max(100,"Venue name must be at most 100 characters."),tickets:p().min(1,"Number of tickets must be at least 1.").max(1e5,"Number of tickets must be at most 100,000."),startTime:l().min(1,"Start time is required."),deadNationId:_("Dead Nation ID must be a valid UUID.").min(1,"Dead Nation ID is required.")});function f(){const{mutate:r,isPending:i}=B({onSuccess:t=>{a.reset(),j.success("Show created successfully!",{description:`Show ID: ${t.show_id}`})},onError:t=>{j.error("Failed to create show",{description:t.message})}}),a=S({defaultValues:{title:"",venue:"",tickets:0,startTime:"",deadNationId:""},validators:{onChange:E},onSubmit:async({value:t})=>{r({title:t.title,venue:t.venue,number_of_tickets:t.tickets,start_time:new Date(t.startTime).toISOString(),dead_nation_id:t.deadNationId})}}),o=()=>{a.setFieldValue("deadNationId",y())};function v(t){t.preventDefault(),a.handleSubmit()}return e.jsxs(h,{className:"animate-in fade-in slide-in-from-bottom-4 duration-500 delay-100",children:[e.jsx(h.Header,{children:e.jsx(h.Title,{children:"CREATE NEW SHOW"})}),e.jsx(h.Content,{children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsx(a.Field,{name:"title",children:t=>{const n=t.state.meta.isTouched&&t.state.meta.errors.length>0;return e.jsxs(d,{"data-invalid":n,children:[e.jsx(c,{htmlFor:"title",children:"Show Title"}),e.jsx(u,{id:"title",value:t.state.value,onChange:b=>t.handleChange(b.target.value),onBlur:t.handleBlur,placeholder:"e.g., The Clash Live"}),t.state.meta.isTouched&&e.jsx(m,{errors:t.state.meta.errors})]})}}),e.jsx(a.Field,{name:"venue",children:t=>e.jsxs(d,{"data-invalid":t.state.meta.isTouched&&t.state.meta.errors.length>0,children:[e.jsx(c,{htmlFor:"venue",children:"Venue"}),e.jsx(u,{id:"venue",value:t.state.value,onChange:n=>t.handleChange(n.target.value),onBlur:t.handleBlur,placeholder:"e.g., CBGB"}),t.state.meta.isTouched&&e.jsx(m,{errors:t.state.meta.errors})]})}),e.jsx(a.Field,{name:"tickets",children:t=>e.jsxs(d,{"data-invalid":t.state.meta.isTouched&&t.state.meta.errors.length>0,children:[e.jsx(c,{htmlFor:"tickets",children:"Number of Tickets"}),e.jsx(u,{id:"tickets",type:"number",value:t.state.value||"",onChange:n=>t.handleChange(n.target.value===""?0:Number(n.target.value)),onBlur:t.handleBlur,placeholder:"e.g., 500",min:"1"}),t.state.meta.isTouched&&e.jsx(m,{errors:t.state.meta.errors})]})}),e.jsx(a.Field,{name:"startTime",children:t=>e.jsxs(d,{"data-invalid":t.state.meta.isTouched&&t.state.meta.errors.length>0,children:[e.jsx(c,{htmlFor:"startTime",children:"Start Time"}),e.jsx(u,{id:"startTime",type:"date",value:t.state.value,onChange:n=>t.handleChange(n.target.value),onBlur:t.handleBlur}),t.state.meta.isTouched&&e.jsx(m,{errors:t.state.meta.errors})]})}),e.jsx(a.Field,{name:"deadNationId",children:t=>e.jsxs(d,{className:"md:col-span-2","data-invalid":t.state.meta.isTouched&&t.state.meta.errors.length>0,children:[e.jsx(c,{htmlFor:"deadNationId",children:"Dead Nation ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{id:"deadNationId",value:t.state.value,onChange:n=>t.handleChange(n.target.value),onBlur:t.handleBlur,placeholder:"Click generate or enter manually",className:"flex-1"}),e.jsx(g,{type:"button",variant:"secondary",onClick:o,children:"Generate UUID"})]}),t.state.meta.isTouched&&e.jsx(m,{errors:t.state.meta.errors})]})})]}),e.jsx(g,{type:"submit",disabled:i,children:i?"Creating...":"Create Show"})]})})]})}function H(){const{data:r,isLoading:i,error:a}=T();return i?e.jsx("p",{className:"text-center py-8 text-lg",children:"Loading shows..."}):a?e.jsxs("p",{className:"text-center py-8 text-lg text-red-600",children:["Error loading shows: ",a.message]}):r==null||r.length===0?e.jsx("p",{className:"text-center py-8 text-lg",children:"No shows created yet. Create your first show above!"}):e.jsxs(s,{children:[e.jsx(s.Header,{children:e.jsxs(s.Row,{children:[e.jsx(s.Head,{children:"Show ID"}),e.jsx(s.Head,{children:"Title"}),e.jsx(s.Head,{children:"Tickets"}),e.jsx(s.Head,{children:"Dead Nation ID"})]})}),e.jsx(s.Body,{children:r.map(o=>e.jsxs(s.Row,{children:[e.jsx(s.Cell,{className:"font-mono text-sm",children:o.show_id}),e.jsx(s.Cell,{className:"font-bold",children:o.title}),e.jsx(s.Cell,{children:o.number_of_tickets}),e.jsx(s.Cell,{className:"font-mono text-sm",children:o.dead_nation_id})]},o.show_id))})]})}function W(){return e.jsxs("div",{className:"space-y-8",children:[e.jsx(f,{}),e.jsx(H,{})]})}export{W as component};
